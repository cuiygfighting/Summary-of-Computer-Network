# 计算机网络知识总结               

*********Written by Yugui Cui**\*******

## 1.计算机网络概述

### OSI参考模型与TCP/IP分层模型

![Xshot-0809](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0809.PNG)

OSI(参考模型)将通信功能划分为7个分层，称作OSI参考模型。每个分层都接收由它下一层所提供的特定服务，并且负责为自己的上一层提供特定的服务。上下层之间进行交互时所遵循的约定叫做"接口"，同一层之间交互时所遵循的约定叫"协议"。
优点：分层可以将每个分层独立使用，即使系统中某些分层发生变化，也不会波及整个系统。因此，可以构造一个扩展性和灵活性都比较强的系统。此外，通过分层能够细化通信功能，更易于实现每个分层的协议，并界定各个分层的具体责任和义务。
缺点：OSI参考模型过于模块化，使处理变得更加沉重以及每个模块都不得不实现相似的处理逻辑。

![Xshot-0810](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0810.PNG)

![Xshot-0813](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0813.PNG)

#### 应用层：

为应用程序提供服务并规定应用程序中通信相关的细节，包括文件传输，电子邮件，远程登陆(虚拟终端)等协议。

#### 表示层：

主要负责数据格式的转换。将应用处理的信息转换为适合网络传输的格式，或将来自下一层的数据转换为上层能够处理的格式。

具体来说，就是将设备固有的数据格式转换为网络标准传输格式。

#### 会话层：

通信管理。负责建立和断开通信连接(数据流动的逻辑通路)，以及数据的分割,记录数据传送顺序等数据传输相关的管理。
会话层负责决定建立连接和断开连接的时机，而实际的建立和断开连接由传输层实现。

#### 传输层：

保证可靠传输。管理两个节点之间的数据传输。只在通信双方结点上进行处理，而无需在路由器上处理。
进行建立连接和断开连接的处理，在两个主机之间创建逻辑上的通信连接。为确保所传输的数据到达目标地址，传输层会在通信两端的计算机之间进行确认，如果数据没有到达，它会负责重发。

#### 网络层：

将数据传输到目标地址。目标地址可以是多个网络通过路由器连接而成的某一个地址，因此这一层主要负责寻址和路由选择。

#### 数据链路层：

互连设备之间传送和识别数据帧。负责物理层面上互连的,结点之间的通信传输，负责数据帧的生成与接收，将0,1序列划分为具有意义的数据帧传送给对端。

通信传输实际上是通过物理的传输介质实现的，数据链路层的作用就是在这些通过传输介质互连的设备之间进行数据处理。

**网络层与数据链路的关系：**

网络层和数据链路层都是基于目标地址将数据发送给接收端的，但是网络层的地址是IP地址负责,将这个数据发送给最终目标地址；而数据链路层的地址是MAC地址,只负责发送一个分段内的数据。数据链路层的主要作用是在互连的同一种数据链路的节点之间进行包传递，而一旦跨越多个数据链路，就需要借助网络层，网络层可以跨越不同的数据链路，实现点对点通信。

在网桥或交换集线器等物理层或数据链路层数据包转发设备中，不需要设备IP地址。因为这些设备只负责将IP包转化为0,1比特流或对数据链路帧的数据部分进行转发，而不需要对应IP协议。

#### 物理层：

负责0,1比特流与电压的高低,光的闪灭之间的转换。

物理层中，将数据的0,1转换为电压和脉冲光传输给物理的传输介质，而相互直连的设备之间使用MAC(Media Access Control,介质访问控制,也称为物理地址或硬件地址)地址实现传输。

### 相关知识点

计算机网络，根据其规模可分为WAN(Wide Area Network，广域网)和LAN(Local Area Network，局域网)。

万维网(WWW,World Wide Web)。

The Internet:互联网。互联网中的每个网络都是由骨干网(BackBone)和末端网(Stub)组成的。每个网络之间通过NOC(Network Operation System，网络操作中心)相连，如果网络的运营商不同，它的网络连接方式和使用方法也会不同，连接这种异构网络需要有IX(Internet Exchange，网络交换中心)的支持。总之，互联网就是通过IX互连的一个巨型网络。

Internet：网际网		

Intarnet：与Internet对应，指使用Internet技术将企业内部的组织机构连接起来形成一个企业范围内的封闭网络，提供面向企业内部的通信服务。

TCP(Transmision Control Protocol)，IP(Internet Protocol)是互联网众多通信协议中最为著名的，是利用IP进行通信所用到的众多的协议群的统称。互联网协议就是TCP/IP协议，TCP/IP协议就是互联网协议。

ISP(Internet Service Provider)，为个人,公司或者教育机构等提供互联网接入服务的供应商。

##### 协议

协议就是计算机与计算机之间通过网络实现通信时事先达成的一种"约定"，使不同厂商的设备、不同的CPU以及不同的操作系统组成的计算机之间，只要遵循相同的协议就能够实现通信。
为了对协议进行标准化，ISO(International Organization System，国际标准化组织)制定了一个国际标准OSI(Open System Interconnect，开放式通信系统互联标准)。现在，OSI所定义的协议虽然没有得到普及，但是在OSI协议设计之初作为其指导方针的OSI参考模型却常被用到网络协议的制定当中。

TCP/IP并非ISO所制定的某种国际标准，而是由IEFT(Internet Engineering Task Force)所建议的，致力推进其标准化的一种协议。具有两大特点：一是具有开放性，二是注重实用性，即被标准化的协议能否被实际运用。
所谓标准化是指使不同厂商所生产的异构产品之间具有兼容性，便于使用的规范化过程。

##### 传输方式的分类

面向有连接型：在发送数据之前，需要在收发主机之间建立一条通信线路。包括ATM,帧中继,TCP等。

面向无连接型：不要求建立和断开连接，发送端可与任何时候自由发送数据，接收端永远也不知道自己会在何````````时从何处收到数据。因此，在面向无连接的情况下，接收端需要时常确认是否收到了数据。包括以太网,IP,UDP等。

电路交换：计算机之间在发送数据时，需要通过交换机与目标主机建立通信电路，之后两台计算机可以独占线路进行数据传输，计算机之间的传输速度不变。

分组交换：让连接到通信电路的计算机将所要发送的数据分成多个数据包，按照一定的顺序排列之后分别发送。在分组交换中，由分组交换机(路由器)连接通信线路，分组交换的大致过程是：发送端计算机将数据分组发送给路由器，路由器收到这些分组数据后，缓存到自己的缓存区，然后再转发给目标计算机，因此分组交换也叫蓄积交换。在分组交换中，计算机与路由器之间以及路由器与路由器之间通常只有一条通信线路，因此这条线路是一条共享线路，由于网络的拥堵状况,路由器的缓存饱和或溢出等会导致传输速度的不稳定。

根据目标地址的个数及其后续的行为可以将通信分为**单播**(Unicast，如电话通信)，**广播**(Broadcast，同一数据链路内的所有计算机，不经过路由器，路由器会分割数据链路层，如电视播放，进行广播通信的计算机也有它们的广播范围，称为广播域)，**多播**(Multicast，限定某一组主机作为接收端，如远程会议)，**任播**(Anycast，在特定的多台主机中选出一台最符合网络条件的主机作为目标主机，如DNS服务器)。

##### 地址

IP地址由网络号和主机号构成，网络号相同说明处于同一个网段，一般属于一个部门或i这集团组织。IP地址具有层次性，网络号相同的主机在组织结构,提供商类型和地域分布上都比较集中，为IP寻址带来了极大的便利。

MAC地址由设备的制造厂商针对每块网卡(Network Interface Card)进行分别指定，具有唯一性，但不具有层次性。

![Xshot-0811](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0811.PNG)

##### 网络的构成要素

![Xshot-0812](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0812.PNG)

##### 现代网络实态

城市之间用**骨干网**连接，选用高速路由器相互连接快速传输大量数据，类似于高速公路。网络中相应于高速公路出入口的部分称为**边缘网络**，常用的设备有多功能路由器和3层交换机。计算机网络中连接边缘网络的部分叫做**接入层**。骨干网专注于如何提高业务传输性能和网络的生存性，而将具有业务智能化的高速路由器和交换机移到网络的边缘。

**托管主机服务**：托管主机服务指将用于信息发布的主机放置于互联网数据中心的机房，或者从该机房租赁一台计算机作为发布信息主机的服务。

**数据中心**：针对高并发访问，托管主机服务，为了减少网络的延迟，会集合多个存储于一起，通过连接高速网络，以期提高响应速度，这种方式称为数据中心。数据中心有大型服务器,存储以及计算机网络组成，一般直接连接到骨干网或者边缘网络。

**虚拟化和云**：当一个网站需要调整运营所使用的资源时，并不增减服务器,存储设备,网络等实际的物理设备，而是用软件将物理设备虚拟化，在有必要增减资源的时候，通过软件按量增减的一种机制。这种方式可以实现按需分配,按比例分配，对外提供可靠的服务。
利用虚拟化技术，根据使用者的情况动态调整必要资源的机制称为**云**。而且，将虚拟化的系统根据需要自动地进行动态管理的部分被称为**智能协调层**，它能够将服务器,存储,网络看作一个整体进行管理。

## 2.数据链路层

**(对应于TCP/IP的网卡层，即网络接口层，包括以太网驱动程序)**

数据链路层的协议定义了通过通信媒介互连的设备之间传输的规范。通信媒介包括双绞线电缆，同轴电缆，光纤，电磁波以及红外线等介质。此外，各个设备之间有时也会通过交换机,网桥,中继器等中转数据。

不同数据链路有个最大区别，就是它们各自的最大传输单位(**MTU**:Maximum Transmission Unit)不同

数据链路的各种主要协议如下：

![Xshot-0814](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0814.PNG)

#### MAC

MAC地址用于识别数据链路中互连的节点。

![Xshot-0815](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0815.PNG)

#### 共享与非共享介质型网络

从通信介质的使用方法上看，网络可分为共享介质型和非共享介质型。

共享介质型网络是指由多个设备共享一个通信介质的一种网络，基本上采用半双工通信(只发送或接收的通信方式)，并有必要对介质进行访问控制。共享性介质网络中有两种介质访问控制方式：一种是争用方式，一种是令牌传递方式。

非共享型介质网络指不共享介质，是对介质采取专用的一种传输控制方式。在这种方式下，网络中的每个站直连交换机，由交换机负责转发数据帧。此方式下，发送端与接收端并不共享通信介质，因此多数情况下采用全双工通信方式(在同一时间既可以发送数据也可以接收数据)。ATM和当今的以太网一般都采用这种方式，该方式还可以根据交换机的高级特性构建虚拟局域网(VLAN,Virtual Loacl Network)，进行流量控制等。但是，这种方式也有一个致命的弱点，那就是一旦交换机发生故障，那与之相连的所有计算机之间都无法进行通信。

![Xshot-0816](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0816.PNG)

#### 以太网

在众多数据链路中最为著名,使用最为广泛的莫过于以太网(Ethernet)，它的规范简单，易于NIC(网卡)及驱动程序实现。

以太网因通信电缆的不同及通信速度的差异，衍生出众多不同的以太网类型。通信介质包括同轴电缆，双绞线等。

以太网帧的格式：

![Xshot-0817](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0817.PNG)

以太网前端有一个叫前导码(Preambel)的部分，它是由0,1数字交替组合而成，表示一个以太网帧的开始，也是对端网卡能够确认与其同步的标志。

类型包含表示协议类型的编号，表明了以太网上一层网络协议的类型，常用的有IP 0800,ARP 0806,RARP 8035以及IPv6 86DD。

帧尾是一个叫做FCS(Frame Check Sequence,帧检验序列，保存着整个帧除以多项式的余数)的4个字节。它可以检查帧是否有所损坏。在通信过程中如果出现电子噪声的干扰，可能会影响发送数据导致乱码位的出现。因此，通过检查这个FCS字段的值可以将哪些受到噪声干扰的错误帧丢弃。

#### 无线通信

无线通信通常使用电磁波,红外线,激光等方式进行传播数据，一般在办公室或家庭的局域网范围内组成的较为高速的连接称为无线局域网。

包括蓝牙(是使用2.4Ghz频率无线电波的一种标准)，Wi-Fi(WireLess Fidelity，指高质量的无线LAN)，WiMax(Worldwide Interoperability for Microware Access，是使用微波在企业或家庭实现无线通信的一种方式)，ZigBee(主要用于家电的远程控制，是一种短距离,低功耗的无线通信技术)等。

#### PPP

PPP(Point-to-Point Protocol)是指点对点，即1对1连接计算机的协议，相当于位于OSI参考模型的第2层数据链路层。

PPP不像以太网和FDDI，后两者不仅与数据链路层有关，还与物理层有关。具体来讲，以太网使用同轴电缆或双绞线，它可以决定其中0,1被解释为何种电子信号。而PPP属于纯粹的数据链路层，与物理层没有任何关系，需要物理层的支持，可以使用电话线或ISDN，专线，ATM线路等。

**PPPoE**是在以太网上的数据中加入PPP帧进行传输的一种方式。单纯的以太网没有验证功能，也没有建立和断开的处理，因此无法按时计费。而如果采用PPPoE管理以太网连接，就可以利用PPP的验证等功能使各家互联网接入服务商可以有效地管理终端用户的使用。

## 3.IP网络层

IP(Internet Protocol,网际协议)，主要负责将数据包发送给目标地址的计算机，实现终端节点之间的通信，即点对点通信。

IP大致分为3个作用模块，分别是IP寻址，路由控制(Routing，将分组数据发送到最终节点)，以及IP分包和组包。

IP面向无不连接。即在发包之前，不需要建立与对端目标地址之间的连接。上一层如果遇到需要发送给IP的数据，该数据会立即被压缩成IP包发送出去。它并不做"最终收到与否的验证"，IP数据包在途中可能会发生丢包，错位以及数据量翻倍等问题。如果说IP只负责将数据发送给主机，那么TCP则负责保证对端主机确实收到了数据。
为什么IP要采用面向无连接呢？一是为了简化，二是为了提速。
需要有连接时，可以委托上一层提供次服务。

IP地址有"网络标识(网络地址)"和"主机标识(主机地址)"两部分组成。
网络标识在数据链路的每个段配置不同的值，网络标识必须保证相互连接的每个段的地址不相重复。而相同段内相连的主机必须有相同的网络地址。主机标识则不允许在同一个网段内重复出现。IP地址具有层次性和唯一性。IP地址分为A,B,C,D四个级别。

#### 子网掩码

IP地址的网络标识和主机表示的位数受限与该地址的类别，可能导致网络标识不够用。通过子网掩码可以将A,B,C类网络地址细分出更小粒度的子网，一个IP地址可以不受限于自己的类别，而是可以通过子网掩码自由地定位自己的网络标识的长度。这种方式，实际上是将原来A,B,C类分类中的主机地址部分作为子网地址，将原网络划分为多个物理网络的一种机制。

#### CIDR和VLSM

CIDR(Classless Inter-Domain Routing，无类型域间选路)，采用任意长度分割IP地址的网络标识和主机标识，根据CIDR，连续多个C类地址就可以划分到一个较大的网络内，更有效地利用了当前的IPv4地址，同时通过路由集中降低了路由器的负担。

VLSM(Variable Length Susnet Mask，可变长子网掩码)，可以随机修改组织内各部门的子网掩码长度。

#### IPv4首部

![Xshot-0819](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0819.PNG)

#### IPv6首部

![Xshot-0820](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0820.PNG)

#### DNS

DNS(Domain Name System)，将主机名转换为IP地址。

在应用中，当用户输入主机名(域名)时，DNS会自动检索那个注册了主机名个IP地址的数据库，并迅速定位对应的IP地址。而且，如果主机名和IP地址需要变更时，也只需要在组织机构内部进行处理即可，而没必要再向其他的机构进行申请或报告。

域名是为了识别主机名称和组织名称的一种具有分层的名称。

#### ARP

ARP(Address Resolution Protocol)是一种解决地址问题的协议。以目标IP地址为线索，用来定位下一个应该接收数据分包的网络设备对应的MAC地址。如果目标主机不在同一个链路上，可以通过ARP查找下一跳路由器的MAC地址。

工作机制：从一个IP地址发送ARP请求包以了解其MAC地址，目标地址将自己的MAC地址填入ARP响应包返回到IP地址。由此，可以通过ARP从IP地址获得MAC地址，实现链路内的IP通信。

RARP(Reverse Address Resolution Protocol)是将ARP反过来，从MAC地址定位IP地址的一种协议。例如将打印机服务器等小型嵌入式设备接入到网络时就经常会用得到。

#### ICMP

ICMP用于确认网络是否正常工作，以及遇到异常时进行问题诊断。

主要功能包括：确认IP包是否成功到达目标地址，通知在发送过程中IP包被遗弃的具体原因，改善网络设置等。

ICMP的消息大致可以分为两类：一类是通知出错原因的错误消息，另一类是用于诊断的查询消息。

#### DHCP

DHCP(Dynamic Host Configuration Protocol)，用于实现自动设置IP地址,统一管理IP地址分配。有了DHCP，计算机只要连接到网络，就可以进行TCP/IP通信，也就是说，DHCP实现了即插即用。

使用DHCP之前，首先要架设一台DHCP服务器，然后将DHCP所要分配的IP地址设置到服务器上，此外，还需要将相应的子网掩码,路由控制信息以及DNS服务器的地址设置到服务器上。对于家庭小规模的网段，很多时候，DHCP服务器由该网段的路由器充当；对于企业或学校等较大规模组织机构的网络环境当中，一般会有多个以太网(无线LAN)网段，可以在每个网段设置一个DHCP中继代理器。它可以设置DHCP服务器的IP地址，从而可以在DHCP服务器上为每个网段注册IP地址的分配范围。

#### NAT

NAT(Network Address Translator)，用于在本地网络中使用私有地址，在连接互联网时转换为全局IP地址。

除转换IP地址外，还出现了可以转换TCP,UDP端口号的NAPT(Network Address Port Translator)技术，由此可以实现用一个全局IP地址与多个主机的通信。

NAT实际是为了正在面临地址枯竭的IPv4而开发的技术。

**NAT-PT(NAPT-PT):**将IPv6首部转换为IPv4的首部的一种技术。有了这种技术，那些只有IPv6地址的主机只能够与IPv4地址的其他主机进行通信了。

#### IP隧道

在网络层的首部后面继续追加网络层首部的通信方法。用于实现不同类型的网络之间的通信。

### 路由控制协议

IP地址的网络地址部分用于进行路由控制。路由器根据**路由控制表(Routing Table)**转发数据包，路由控制表中记录着**网络地址**与下一步应该发送至路由器的地址(包括网络地址和主机地址)。

路由控制分为静态路由和动态路由。静态路由是指事先设置好路由器和主机并将路由信息固定的一种方法，通常有使用者手工操作完成。而动态路由是指让路由协议在运行过程中自动地设置路由控制信息的一种方法。

路由协议用来交换路由信息从而设置好各个路由器的路由控制表。路由协议根据路由控制的范围分为**IGP**(Interior Gateway Protocol,内部网关协议，域内路由协议)和**EGP**(Exterior Gateway Protocaol,外部网关协议，域间路由协议)。IGP

**自治系统和路由协议：**制定自己的路由策略，并以此为准在一个或多个网络群体中采用的小型单位叫做自治系统(AS:Autonomous System)或者路由选择域(Routing Domain)。自治系统(路由选择域)内部动态路由控制采用的协议是IGP，而自治系统之间采用的协议是EGP。

IGP包括RIP(Routing Information Protocol，路由信息协议)，RIP2，OSPF(Open Shortest Path First，开放式最短路径优先)。EGP包括BGP(Border Gateway Protocol，边界网关协议)。

![Xshot-0870](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0870.png)

#### 路由算法：

##### 距离向量算法(Distance Vector)

距离向量算法是根据距离(代价)和方向决定目标网络或目标主机位置的一种方法。路由器之间可以互换目标网络的方向及其距离的相关信息，并以此为基础制作路由控制表。

这种方法在处理上比较简单，不过由于只有距离和方向的信息，所以当网络构造变得十分复杂时，在获得稳定的路由信息之前需要消耗一定时间，也极易发生路由循环等问题。

##### 链路状态法(Link state)

链路状态法是路由器在了解网络整体连接状态的基础上生成路由控制表的一种方法。该方法中，每个路由器必须保持同样的信息才能进行正确的路由选择。

距离向量算法每个路由器撞我的信息都不相同，通往每个网络所耗的距离(代价)也根据路由器的不同而不同。因此，该算法的一个缺点就是不太容易判断每个路由器的上的信息是否正确。

而链路状态算法中的所有路由器持有相同的信息。对于每一台路由器，网络拓扑都完全一样。只要每个路由器尽快地与其他路由器同步路由信息，就可以使路由信息达到一个稳定的状态。因此，即使网络结构变得复杂，每个路由器也能够保持正确的信息，进行稳定的路由选择。

为了达到上述机制，链路状态算法付出的代价就是如何从网络代理获取路由信息表，这一过程相当复杂，在一个规模巨大而又复杂的网络结构中，管理和处理代理

信息需要高速CPU处理能力和大量的内存。

#### RIP

**广播路由控制信息**

![Xshot-0871](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0871.png)

**根据距离向量数据库生成路由控制表**

距离(Metrics)的单位为"跳数"，即**经过**的路由器的个数。

![Xshot-0872](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0872.png)

**无限计数问题(Counting to Infinity)**

路由器反复收到自己曾经发出的消息。解决这个问题可以采取下面两种方法：

* 一是最长距离为16。由此即使发生无限计数问题，也可以从时间上进行控制。
* 二是规定路由器不再把所收到的路由消息原路返还给发送端。称为水平分割(Split Horizon)。

在有环路的情况下，反向的回路会称为迂回的通道，路由信息会不断地被循环往复的转发。当环路内部某一处发生通信故障时，通常可以设置正确的迂回通道。当环路外部发生通信故障时，将无法传送正确的路由信息。尤其是在环路多余的情况下，需要很长时间才能产生正确的路由信息。

为了尽可能解决这个问题，人们提出了**毒性逆转(Poisoned Reverse)**和**触发更新(Triggered Update)**。
毒性逆转是指当网络中发生链路被断开的时候，不再发生这个消息，而是将这个无法通信的消息传播出去，即发送一个距离为16的消息。
触发更新是指当路由信息发生变化时，不等待30秒而是立刻发送出去的一种方法。
有了这两种方法，当链路不通时，可以迅速传送消息以使路由信息尽快收敛。

#### OSPF

是一种链路状态路由协议。路由器之间交换链路状态生成网络拓扑信息，然后再根据这个拓扑信息生成路由控制表。

RIP的路由选择，要求途中所经过的路由器个数越少越好。而OSPF可以给每条链路赋予一个权重，并选择一个权重最小的路径作为最终路由。

由网络LSA(Network link State Advertisement，网络链路状态，以网络为中心生成的信息，表示这个网络都与哪些路由器相连)和路由器LSA(路由器链路状态，以路由器为中心生成的信息，表示该路由器都与哪些网络相连)生成一个可以表达网络结构的链路状态数据库，并根据这个数据库采用Dijkstra算法生成相应的路由控制表。

相比于距离向量，有上述过程生成的路由控制表更加清晰不容易混淆，还可以有效降低无限循环问题的发生。不过，当网络规模逐渐越大时，表示链路状态的拓扑数据库就会变得越来越大，最短路径有限算法的处理时间就会变得越长，对CPU和内存的消耗也越大。为了解决计算负荷，引入了区域的概念。

**区域**是指将连接在一起的网络或主机划分为小组，使一个自治系统内部可以拥有多个区域。不过具有多个区域的自治系统必须有一个主干区域(Backbone Area)，并且所有其他区域都必须与这个主干区域相连接。

连接区域与主干区域的路由器称作区域边界路由器，而区域内部的路由器叫做内部路由器，只与主干区域内连接的路由器叫做主干路由器，与外部相连接的路由器就是AS边界路由器。

每个区域内的路由器都持有本区域网络拓扑的数据库。关于区域之外的路径信息，只能从区域边界路由器那里获知它们的距离。区域边界路由器也不会将区域内的链路状态信息全部原样发送给其他区域，只会发送自己到达这些路由器的距离信息，这样内部路由器所持有的网络拓扑数据库就会明显变小。

![Xshot-0873](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0873.png)

#### BGP

边界网关协议是连接不同的组织机构(自治系统)的一种**路径向量(Path Vector)**型协议。它属于外部网关协议(EGP)，主要用于ISP之间相连接的部分。只有BGP,RIP,OSPF共同进行路由控制，才能够进行整个互联网的路由控制。

在RIP和OSPF中利用IP的网络地址部分进行路由控制，然而BGP则需要放眼整个互联网进行路由控制。BGP的最终路由控制表由网络地址和下一站的路由器组来表示，会根据所要经过的AS个数进行路由控制。

ISP，区域网络等会将每个网络域编配成一个个自治系统进行管理，给每个自治系统分配一个16比特的AS编号，BGP就是根据这个编号进行相应的路由控制。

![Xshot-0874](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0874.png)

BGP中数据包到达目标网络时，会生成一个中途所经过所有AS的编号列表，叫做AS路径信息访问列表(AS Path List)，不仅包括转发方向和距离，还涵盖途径所有AS的编号。

在进行路由选择时，RIP以经过的路由器个数为度量，OSPF以每个子网的成本为度量，而BGP以AS进行度量。RIP和OSPF本着以转发效率为目的，考虑到网络的跳数和网络的带宽，而BGP则基于AS之间的合约进行数据包的转发，一般从AS路径信息访问列表中选择一个较短的路径，不过仍然需要遵循每个AS之间签约的细节进行更细粒度的路由选择。

作为路径向量型协议，BGP能够检测出环路，避免无限计数的问题，更容易令网络进入一个稳定的状态。同时，它还具有支持策略路由的优势。

#### MPLS

现如今，在转发IP数据包的过程中除了使用路由技术外，还在使用标记交换技术。路由技术基于IP地址中最长匹配原则进行转发，而标记交换则对每个IP包都设定一个叫做"标记"的值，然后根据这个标记再进行转发。

标记交换技术中最具代表性的当属多协议标记交换技术，即MPLS(Multi Protocol Label Switching)。

MPLS的标记不像MAC地址直接对应到硬件设备，因此，MPLS不需要具备以太网或ATM等数据链路层协议的作用，而只需要关注它与下一层IP层之间的功能和协议。由于基于标记的转发通常无法在路由器上进行，所以MPLS也就无法被整个互联网采用，它的转发处理方式甚至与IP网也有所不同。

## 4.传输层

### TCP：

Transmision Control Protocol

TCP是一种面向有连接的,可靠的流协议。它可以保证两端通信主机之间的通信可达，提供可靠的通信传输。实行“顺序控制”或"重发控制”机制，可以正确处理在传输过程中丢包,传输顺序乱掉等异常情况，还具备“流控制(流量控制)”,"拥塞控制",能够有效利用带宽，缓解网络拥堵,提高网络利用率。

然而，为了建立与断开连接，它需要至少7次的发包收包，导致网络流量的浪费。此外，为了提高网络利用率，TCP协议中定义了各种各样复杂的规范，不利于视频会议(音频,视频的数量既定)的场合使用。

#### TCP相关控制细节

TCP提供检验和，序列号，确认应答，重发控制，连接管理以及窗口控制等机制实现可靠传输。

##### 通过序列号和确认应答提高可靠性

##### 连接管理

![Xshot-0847](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0847.png)

##### TCP以段为单位发送数据

在建立TCP连接的同时，也可以确定发送数据包的单位，我们可以将其称之为最大消息长度(MSS，Maxmum Segment Size)。最理想的情况是，最大消息长度正好是IP中不会被分片处理的最大数据长度。TCP在发送大量数据时，是以MSS的大小将数据进行分割发送。进行重发时也是以MSS为单位。MSS是在三次握手时，在两端主机之间被计算得出。两端主机在发出建立连接的请求时，会在TCP首部写入MSS选项，高告诉对方自己的接口能够适应的MSS大小，然后会在两者之间选一个较小的值投入使用。

##### 利用滑动窗口提高速度

TCP以一个段为单位，每发送一个段需要进行一次确认应答的处理，这样造成包的往返时间越长通信性能越低。为解决这个问题，TCP使用引入了窗口这个概念。确认应答不再是以每个分段，而是以更大的单位进行确认，发送端主机在发送了一个段之后不必一直等待确认应答，而是继续发送，这样可以大幅缩短转发时间。

###### 窗口控制与重发机制

在确认应答未能返回的情况下，数据已经达到了对端，不需要再进行重发。使用了窗口控制，某些确认应答即便丢失了也无需重发。

在某个报文段丢失的情况下，发送端主机如果连续3次收到同一个确认应答，才会对其所对应的数据进行重发，这种机制比之前的超时重发管理机制更加有效，因此也被称作高速重发机制。

###### 流控制（流量控制）

让发送端根据接收端的实际接受能力控制发送的数据量，即由接收端调整滑动窗口大小。

##### 拥塞控制

一般来说，计算机网络都处于一个共享的环境中。在网络出现拥堵时，如果突然发送一个较大量的数据，可能会导致整个网络的瘫痪。TCP为了防止这个问题的出现，在通信一开始就会通过一个叫做慢启动的算法得出相应的数值，对发送数据量进行控制。为了在发送端调节发送数据的量，定义了一个叫做"拥塞窗口"的概念

##### 提高网络利用率的规范

###### Nagle算法

该算法是指发送端即使还有应该发送的数据，但如果这部分数据很少的话，则进行延迟发送的一种处理机制。

###### 延迟确认应答

接收数据的主机如果每次都立刻回复一个确认应答的话，可能会返回一个较小的窗口，那是因为刚接收完数据，缓冲区已满。为此，可以在接收完数据以后不立即返回确认应答，而是延迟一段时间。TCP文件传输中，绝大多数是以每两个数据段返回一次确认应答。

###### 捎带应答(PiggyBack Acknowledgement)

指在同一个TCO包中既发送数据又发送确认应答的一种机制，可以提高网络利用率，减轻计算机的负荷。如远程登陆中针对输入的字符进行回收校验。不过，确认应答必须得等到应用处理完数据并将作为回执的数据返回为止，才能进行捎带应答，因此，捎带应答必须启用延迟确认应答。

#### TCP首部

![Xshot-0849](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0849.png)

### UDP：

User Datagram Protocol/用户数据报协议

UDP是一种面向无连接的传输层协议，不提供复杂的控制机制，将控制细节交由应用层去处理，自己只提供作为传输层最基本的功能。而且它是在将应用程序发来的数据在收到的那一刻，立即按照原样发送到网络上的一种机制，即可以随时发送数据。不关注对端是否真的接收到了传过去的数据，不进行重发，也无法进行流量控制等避免网络拥塞的行为。如果需要检查对端是否收到了分组数据包，或者是否连接到了网络，则需要在上层的应用程序中实现。UDP简单而高效，适用于高速传输和实时性要求较高的通信或广播通信：

* 包总量较少的通信(DNS，SNMP等)
* 视频，音频等对即时通信要求较高的多媒体通信
* 限定于LAN等特定网络内的应用通信
* 广播通信(广播，多播）
  RIP,DHCP等基于广播的协议也要依赖于UDP

TCP与UDP的优缺点无法简单地,绝对地去做比较，应当根据应用的目的按需使用。如果需要自己处理一些更为细节上的控制，使用UDP协议是不错的选择，适合程序员的控制思路。如果转发数据量较大，对可靠性要求较高，则选择TCP较好。

#### UDP首部

![Xshot-0848](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0848.png)

### 端口号

端口号用来识别同一台计算机中进行通信的不同应用程序，也称为程序地址。传输协议TCP,UDP通过接收数据中的目标端口号识别目标处理程序。

TCP/IP或UDP/IP通信中通常采用5个信息来识别一个通信：源IP地址，目标IP地址，协议号，源端口号，目标端口号。(协议号即是传输层协议，一般是TCP或UDP，不同协议可以使用同一个端口号)

知名端口号(Well-Known Port Number)：

21：ftp	22:ssh	53:domain	80:http(www,www-http)

## 5.应用层

利用网络的应用协议有很多，包括Web浏览器，电子邮件，远程登录，文件传输，网络管理等等。能够让这些应用进行特定的通信处理的正是应用协议。

TCP和IP等下层协议是不依赖于上层应用类型,适应性非常广的协议，而应用协议则是为了实现某种应用而设计和创造的协议。应用之间交互的信息叫做消息。

### 远程登录

远程登录主要使用TELNET和SSH(Secure SHell)两种协议。
Shell是操作系统提供给用户的,便于使用该系统中各种功能的一种用户接口。

#### TELNET

TELNET利用TCP的一条连接，通过这一条连接向主机发送文字命令并在主机上执行。本地用户好像直接与远端主机内部的Shell相连似的，直接在本地进行操作。

TELNET可以分为两类基本服务。一是仿真终端功能，二是协商选项机制。

![Xshot-0875](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0875.png)

TELNET经常用于登录路由器或高性能交换机等网络设备进行相应的设置。提供TELNET登录主机或路由器等设备时需要将自己的用户名和密码注册到服务。

TELNET客户端是指利用TELNET协议实现远程登录的客户端程序，很多情况下，它的程序名就是telnet命令。TELNET客户端通常与目标主机的23号端口进行建立连接，并于监听这个端口的服务端程序telnet进行交互。

行模式指每从键盘属于一个换行，就将该行的数据作为1整行发送给服务端。
透明模式指每输入一个字符都立马发送给服务端。

#### SSH

SSH是加密的远程登录系统。TELNET中登录时无需输入密码就可以发送，容易造成通信窃听和非法入侵的危险。使用SSH后可以加密通信内容，即使信息被窃听也无法破解所发送的密码,具体命令以及命令返回的结果是什么。

SSH还包括很多非常方便的功能：

* 可以使用更强的认证机制。
* 可以转发文件
* 可以使用端口转发功能

端口转发是指将特定端口号所收到的消息转发到特定的IP地址和端口号的一种机制。由于经过SSH连接的那部分内容被加密，确保了信息安全，提供了更为灵活的通信(如VPN)。

### 文件传输

FTP是在两个相连的计算机之间进行文件传输时使用的协议。FTP也需要在登录到对方计算机后才能进行相应的操作。

它使用两条TCP连接：一条用来控制，一条用来数据(文件)传输。

用于控制的TCP连接主要在FTP的控制部分使用。例如登录用户名和密码的验证，发送文件的名称，发送方式的设置。利用这个连接，可以通过ASCII(American Standard Code for Information Interchange)码字符串发送请求和接收应答。控制用的连接使用的是TCP21号端口。在TCP21号端口上进行文件GET，PUT以及文件一览(LIST)等操作时，每次都会建立一个用于数据传输的TCP连接。数据的传输和文件一览表的传输正是在这个新建的连接上进行。当数据传送完毕后，传输数据的这条连接也会被断开，然后会在控制用的连接上继续进行命令或应答的处理。

通常，用于数据传输的TCP连接是按照与控制用的连接相反的方向建立的。因此，在通过NAT连接外部FTP服务器时，无法直接建立传输数据时使用的TCP连接。此时，必须使用PASV命令修改建立连接的方向才行。

数据传输用的TCP连接通常使用端口20。不过可以用PORT命令修改为其他的值。最近，处于安全的考虑，普遍在数据传输用的端口号中使用随机数进行分配。

FTP中请求命令中使用着"RETR"等ASCII码字符串，而针对这些命令的应答则使用如"200"等3位数字的ASCII码字符串。

### 电子邮件(E-mail)

![Xshot-0876](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0876.png)

电子邮件的机制由3部分组成，分别是邮件地址，数据格式以及发送协议。

现在个人邮件地址和邮件组的格式完全相同，光从地址上是无法区分个人电子邮件地址和邮件组的。电子邮件的发送地址由DNS进行管理。DNS中注册有邮件地址及其作为发送地址时对应的邮件服务器的域名。这些映射信息被称为MX(Mail Exchange)，根据MX纪录中指定的邮件服务器，可以管理不同邮件地址与特定邮件服务器之间的映射关系。

**MIME：**电子邮件的数据格式用MIME(Multipurpose Internet Mail Extensions)，MIME规定了应用消息的格式，属于表示层。MIME广泛用于并极大地扩展了数据格式，还可以用于WWW和NetNews。

**SMTP：**(Simple Mail Ttansfer Protocol)是发送电子邮件的协议。SMTP为了实现高效发送邮件内容，在其传输层使用了TCP协议，使用的是TCP的25号端口。SMTP建立一个TCP连接以后，在这个连接上进行控制和应答以及数据的发送。客户端以文本的形式发送请求，服务端返回一个3位数字的应答。每个指令和应答的最后都必须追加换行指令(CR,LF)。

**POP：**个人电脑不可能一直处于开机状态。在这种情况下，人们希望一开机就能接收到邮件。然而SMTP没有这种处理机制，它只支持发送端主机的行为，而不能根据接收端的请求发送邮件。

为了解决这个问题，就引入了POP协议。该协议是一种用于接受电子邮件的协议。发送端的邮件根据SMTP协议将被转发给一直处于插电状态的POP服务器。客户端再根据POP协议从POP服务器接收对方发来的邮件。在这个过程中，为了防止他人盗窃邮件内容，还要进行用户验证。

**IMAP:**Internet Message Access Protocol。与POP类似，也是接收电子邮件的协议。在POP中邮件由客户端进行管理，而在IMAP中邮件则由服务器进行管理。

使用IMAP时，可以不必从服务器上下载所有的邮件也可以阅读，而且还可以对"已读/未读"信息和邮件分类进行管理。因此，即使在不同的计算机上打开邮件，也能保持同步，使用起来非常方便。

有了IMAP人们就可以通过=个人电脑，公司的电脑，手机等连接到IMAP服务器以后进行收发邮件。由此，在公司下载的电子邮件就不必在手机上转来转去，为多种异构终端提供了便利的环境。

### WWW

万维网(World Wide Web)是将互联网中的信息以超文本形式展现的系统，也叫做Web。可以显示WWW信息的客户端软件叫做Web浏览器(Web Browser)。

WWW定义了3个重要概念，分别是访问信息的手段与位置(URI，Uniform Resource Identifier)，信息的表现形式(HTML，HyperText Markup Language)以及信息转发(HTTP，HyperText Transfer Protocol)。

#### URI

URI是Uniform Resource Identifier，用于表示资源。可以用于WWW之外的高效的识别码，被用于主页地址，电子邮件，电话号码等各种组合中。

用于主页地址称为URL(Uniform Resource Locator)，用来表示互联网中资源(文件)的具体位置。但URI不限于标识互联网资源，它可以作为所有资源的识别码。

URI所表示的组合叫方案(Scheme)。在众多URI的Scheme中WWW主要用其中的http和https表示Web页的方法。http的默认端口是80。

#### HTML

HTML是记述Web页的一种语言(数据格式)。它可以指定浏览器中显示的文字，文字的大小和颜色等。此外，不仅可以对图像和动画进行相关设置，还可以设置音频内容。

HTML具有纯文本的功能。在页面中不仅可以为文字或图像附加链接，当用户点击哪些链接时还可以呈现该链接所指向的内容，因此它可以将整个互联网中任何一个WWW服务器中的信息以链接的方式呈现。

HTML可以说是WWW通用的数据表现协议。即使在异构的计算机上，只要是可以用HTML展现的数据，那么效果基本上是一致的。属于表示层。

WWW中将数据存入文件或在应用之间进行交互时经常会使用XML(Extensible Markup Language)，XML是从SGML(Standard Generalized Markup Language)衍生出了的一种语言，与HTML类似，也需要在每个项目的前后加入标签以表达其具体含义。一般，从<标签名>到</标签名>为止表示一个数据。

#### HTTP

当用户在浏览器的地址栏输入所要访问的Web页的URI以后，HTTP的处理即会开始。HTTP默认使用80端口。它的工作机制，首先是客户端向服务器的80端口建立一个TCP连接，然后在这个TCP连接上进行请求和应答以及数据报文的发送。

#### JavaScript,CGI,Cookie

通过在浏览器端和服务器端执行特定的程序可以实现更加精彩，多样的内容。例如实现网络购物或搜索功能。在Web浏览器端执行的程序为客户端程序，在服务器端执行的程序为服务端程序。

JavaScript是一种嵌入在HTML中的编程语言，作为客户端程序可以运行于多种类型的浏览器中。这些浏览器将嵌入JavaScript的HTML下载后，其对应的JavaScript程序就可以在客户端得到执行。这种JavaScript程序用于验证客户端输入字符串是否过长，是否填写或选择了页面的必须选项等功能。

CGI是Web服务器调用外部程序时使用的一种服务端应用的规范。利用CGI可以针对用户的操作返回给客户端有各种各样变化(动态)的信息。论坛和网上购物系统中就经常使用CGI调用外部程序或访问数据库。

Cookie是Web应用中为了获取用户信息使用的一种机制。Web服务器用Cookie在客户端保存信息(多为用户名和登录信息)

### SNMP

Simple Network Management Protocol。是一款基于UDP/IP的网络管理协议。

SNMP中管理端叫做管理器(Manager，网络监控终端)，被管理端叫做代理(路由器，交换机等)。决定管理器与代理之间的通信所要交互信息正是SNMP。SNMP中如果将MIB看做代理所管理的信息在数据库中的值，那么它可以新增一个值。

MIB(Management Information Base)是在树形结构的数据库中为每个项目附加编号的一种信息结构。相当于SNMP的表示层，它是一种能够在网络上传输的结构。

SNMP中可以将MIB值写入代理，也可以从代理读取MIB值。通过这些操作可以收集冲突的次数和流量统计等信息，可以修改接口的IP地址，还可以进行路由器的启停，设备的启动和关闭等处理。

### 其他应用层协议

#### RTP

Real-Time Protocol。为每个报文附加时间戳和序列号。接收报文的应用，根据时间戳决定数据重构的时机。序列号则根据每发出一次报文加一的原则进行累加。RTP使用这个序列号对同一时间戳的数据进行排序，掌握是否有丢包的情况发生。

#### P2P

Peer to Peer。网络上的终端或主机不经过服务器直接1对1相互通信。P2P中主机具备客户端和服务器两方面的功能，以对等的关系相互提供服务。

#### LDAP

Lightweight Directory Access Protocol，是访问目录服务的一种协议。所谓目录服务是指网络上存在的一种提供相关资源的数据库的服务，这里的目录也有地址簿的意思，可以认为目录服务就是管理网络上资源的一种服务。

## 6.网络安全

### 网络安全的构成要素：

![Xshot-0877](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0877.png)

#### 防火墙

组织机构内部的网络与互联网相连时，为了避免域内受到非法访问的威胁，往往会设置防火墙。

防火墙的种类和形态有很多种。例如，专门过滤特定数据包的过滤防火墙，数据达到应用以后有应用处理并拒绝非法访问的应用网关。这些防火墙都有基本相同的设计思路，那就是"暴露给危险的主机和路由器的个数要有限"。

#### IDS(入侵检测系统)

数据包符合安全策略，防火墙才会让其通过。即只要与策略相符，既无法判断当前访问是否为非法，所以全部允许通过。

而IDS正是检查这种已经侵入网络内部进行非法访问的情况，并及时通知给网络管理员的系统。

IDS根据不同的用途可以提供不同的功能。从设置上看，一般在防火墙或DMZ等边界设备上进行设置。有了这样监控,检测边界的功能，就可以设置在网络内部,全网或个别特殊设备的服务器上进行监控。

从功能上看，IDS有定期采集日志,长期监控,通知异常等功能。它可以监控网络上流动的所有数据包。为了确保各种不同的系统的安全，IDS可以与防火墙相辅相成，实现更加安全的网络环境。

**DMZ：**DeMilitarized Zone，非军事化区。在连接互联网的网络中，可以设置一个服务器并其上建立一个允许从互联网直接进行通信的专用子网。这种将外网与内网隔开的专用子网就叫做DMZ。在DMZ中设置的这个服务器对外公开，从而可以排除外部过来的非法访问。万一这台服务器遇到侵袭，也不会波及内部网络。

#### 反病毒/个人防火墙

反病毒和个人防火墙是继IDS和防火墙之后的另外两种安全对策，它们往往是用户使用的计算机或服务器上运行的软件。既可以监控计算机中进出的所有包，数据和文件，也可以防止对计算机的异常操作和病毒入侵。

### 加密技术

为了防止信息的泄露,实现机密数据的传输，出现了各种各样的加密技术。加密技术分布与OSI参考模型的各个阶层一样，相互协作保证通信。

![Xshot-0878](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0878.png)

#### 对称密码体制与公钥密码体制

加密是指利用某个值(密钥)对明文的数据通过一定的算法变换成加密(密文)数据的过程。它的逆反过程叫做解密。

加密和解密使用相同的密钥叫做对称加密方式。反之，如果加密和解密过程中分别使用不同的密钥(公钥和私钥)，则叫做公钥加密方式。

在对称加密方式中，最大的挑战就是如何传递安全的密钥。

公钥加密体制基于大数的质因数分解的困难。公钥加密方式可以安全地保管私钥，不需要传递私钥，仅有一方的密钥是无法解密的。可以通过邮件发送公钥，通过Web公开公钥，或通过PKI分配等方式。

相对于对称密码体制，公钥加密体制更加安全，但在加密和解密上需要花费的时间较长，在对较长的消息进行加密时往往采用两者结合的方式。

![Xshot-0879](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0879.png)

对称加密方式包括AES(Advanced Encryption Standard)，DES(Data Encryption Standard)等加密标准，而公钥加密方法中包括RSA，DH(Diffie-Hellman)，椭圆曲线等加密算法。

### 安全协议

#### IPsec和VPN

之前，为了防止信息泄露，对机密数据的传输一般不适应互联网等公共网络(Public Network)，而是使用有专线连接的私有网络(Private Network)。从而在物理上杜绝了窃听和篡改数据的可能。然而，专线的造价太高是一个问题。

为了解决这个问题，可以在互联网上构建一个虚拟的私有网络，即VPN(Vitual Private Network，虚拟专用网)。互联网中采用的加密和认证技术可以达到"即使读取到数据也无法读懂"和"检查是否篡改"等功效。VPN正是利用这两种技术打造的网络。

在构建VPN时，最常被使用的是IPsec。它是指在IP首部的后面追加"封装安全有效荷载"(ESP，Encapsulating Security Payload)和"认证首部"(AH,Authentication Header)，从而对此后的数据进行加密，不被盗取者轻易解读。

在发包的时候附加上述两个首部，可以在收包时根据首部对数据进行解密，恢复成原始数据。由此，加密后的数据不再被轻易解读，即使在途中被篡改，也能够被及时检测。

基于这些功能，VPN的使用者就可以不必设防地使用一个安全的网络环境。

#### TLS/SSL与HTTPS

TLS/SSL(Transport Layer Secure/Secure Socket Layer)