# 计算机网络知识总结               

*********Written by Yugui Cui**\*******

## 1.计算机网络概述

### OSI参考模型与TCP/IP分层模型

![Xshot-0809](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0809.PNG)

OSI(参考模型)将通信功能划分为7个分层，称作OSI参考模型。每个分层都接收由它下一层所提供的特定服务，并且负责为自己的上一层提供特定的服务。上下层之间进行交互时所遵循的约定叫做"接口"，同一层之间交互时所遵循的约定叫"协议"。
优点：分层可以将每个分层独立使用，即使系统中某些分层发生变化，也不会波及整个系统。因此，可以构造一个扩展性和灵活性都比较强的系统。此外，通过分层能够细化通信功能，更易于实现每个分层的协议，并界定各个分层的具体责任和义务。
缺点：OSI参考模型过于模块化，使处理变得更加沉重以及每个模块都不得不实现相似的处理逻辑。

![Xshot-0810](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0810.PNG)

![Xshot-0813](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0813.PNG)

#### 应用层：

为应用程序提供服务并规定应用程序中通信相关的细节，包括文件传输，电子邮件，远程登陆(虚拟终端)等协议。

#### 表示层：

主要负责数据格式的转换。将应用处理的信息转换为适合网络传输的格式，或将来自下一层的数据转换为上层能够处理的格式。

具体来说，就是将设备固有的数据格式转换为网络标准传输格式。

#### 会话层：

通信管理。负责建立和断开通信连接(数据流动的逻辑通路)，以及数据的分割,记录数据传送顺序等数据传输相关的管理。
会话层负责决定建立连接和断开连接的时机，而实际的建立和断开连接由传输层实现。

#### 传输层：

保证可靠传输。管理两个节点之间的数据传输。只在通信双方结点上进行处理，而无需在路由器上处理。
进行建立连接和断开连接的处理，在两个主机之间创建逻辑上的通信连接。为确保所传输的数据到达目标地址，传输层会在通信两端的计算机之间进行确认，如果数据没有到达，它会负责重发。

#### 网络层：

将数据传输到目标地址。目标地址可以是多个网络通过路由器连接而成的某一个地址，因此这一层主要负责寻址和路由选择。

#### 数据链路层：

互连设备之间传送和识别数据帧。负责物理层面上互连的,结点之间的通信传输，负责数据帧的生成与接收，将0,1序列划分为具有意义的数据帧传送给对端。

通信传输实际上是通过物理的传输介质实现的，数据链路层的作用就是在这些通过传输介质互连的设备之间进行数据处理。

**网络层与数据链路的关系：**

网络层和数据链路层都是基于目标地址将数据发送给接收端的，但是网络层的地址是IP地址负责,将这个数据发送给最终目标地址；而数据链路层的地址是MAC地址,只负责发送一个分段内的数据。数据链路层的主要作用是在互连的同一种数据链路的节点之间进行包传递，而一旦跨越多个数据链路，就需要借助网络层，网络层可以跨越不同的数据链路，实现点对点通信。

在网桥或交换集线器等物理层或数据链路层数据包转发设备中，不需要设备IP地址。因为这些设备只负责将IP包转化为0,1比特流或对数据链路帧的数据部分进行转发，而不需要对应IP协议。

#### 物理层：

负责0,1比特流与电压的高低,光的闪灭之间的转换。

物理层中，将数据的0,1转换为电压和脉冲光传输给物理的传输介质，而相互直连的设备之间使用MAC(Media Access Control,介质访问控制,也称为物理地址或硬件地址)地址实现传输。

### 相关知识点

计算机网络，根据其规模可分为WAN(Wide Area Network，广域网)和LAN(Local Area Network，局域网)。

万维网(WWW,World Wide Web)。

The Internet:互联网。互联网中的每个网络都是由骨干网(BackBone)和末端网(Stub)组成的。每个网络之间通过NOC(Network Operation System，网络操作中心)相连，如果网络的运营商不同，它的网络连接方式和使用方法也会不同，连接这种异构网络需要有IX(Internet Exchange，网络交换中心)的支持。总之，互联网就是通过IX互连的一个巨型网络。

Internet：网际网		

Intarnet：与Internet对应，指使用Internet技术将企业内部的组织机构连接起来形成一个企业范围内的封闭网络，提供面向企业内部的通信服务。

TCP(Transmision Control Protocol)，IP(Internet Protocol)是互联网众多通信协议中最为著名的，是利用IP进行通信所用到的众多的协议群的统称。互联网协议就是TCP/IP协议，TCP/IP协议就是互联网协议。

ISP(Internet Service Provider)，为个人,公司或者教育机构等提供互联网接入服务的供应商。

##### 协议

协议就是计算机与计算机之间通过网络实现通信时事先达成的一种"约定"，使不同厂商的设备、不同的CPU以及不同的操作系统组成的计算机之间，只要遵循相同的协议就能够实现通信。
为了对协议进行标准化，ISO(International Organization System，国际标准化组织)制定了一个国际标准OSI(Open System Interconnect，开放式通信系统互联标准)。现在，OSI所定义的协议虽然没有得到普及，但是在OSI协议设计之初作为其指导方针的OSI参考模型却常被用到网络协议的制定当中。

TCP/IP并非ISO所制定的某种国际标准，而是由IEFT(Internet Engineering Task Force)所建议的，致力推进其标准化的一种协议。具有两大特点：一是具有开放性，二是注重实用性，即被标准化的协议能否被实际运用。
所谓标准化是指使不同厂商所生产的异构产品之间具有兼容性，便于使用的规范化过程。

##### 传输方式的分类

面向有连接型：在发送数据之前，需要在收发主机之间建立一条通信线路。包括ATM,帧中继,TCP等。

面向无连接型：不要求建立和断开连接，发送端可与任何时候自由发送数据，接收端永远也不知道自己会在何````````时从何处收到数据。因此，在面向无连接的情况下，接收端需要时常确认是否收到了数据。包括以太网,IP,UDP等。

电路交换：计算机之间在发送数据时，需要通过交换机与目标主机建立通信电路，之后两台计算机可以独占线路进行数据传输，计算机之间的传输速度不变。

分组交换：让连接到通信电路的计算机将所要发送的数据分成多个数据包，按照一定的顺序排列之后分别发送。在分组交换中，由分组交换机(路由器)连接通信线路，分组交换的大致过程是：发送端计算机将数据分组发送给路由器，路由器收到这些分组数据后，缓存到自己的缓存区，然后再转发给目标计算机，因此分组交换也叫蓄积交换。在分组交换中，计算机与路由器之间以及路由器与路由器之间通常只有一条通信线路，因此这条线路是一条共享线路，由于网络的拥堵状况,路由器的缓存饱和或溢出等会导致传输速度的不稳定。

根据目标地址的个数及其后续的行为可以将通信分为**单播**(Unicast，如电话通信)，**广播**(Broadcast，同一数据链路内的所有计算机，不经过路由器，路由器会分割数据链路层，如电视播放，进行广播通信的计算机也有它们的广播范围，称为广播域)，**多播**(Multicast，限定某一组主机作为接收端，如远程会议)，**任播**(Anycast，在特定的多台主机中选出一台最符合网络条件的主机作为目标主机，如DNS服务器)。

##### 地址

IP地址由网络号和主机号构成，网络号相同说明处于同一个网段，一般属于一个部门或i这集团组织。IP地址具有层次性，网络号相同的主机在组织结构,提供商类型和地域分布上都比较集中，为IP寻址带来了极大的便利。

MAC地址由设备的制造厂商针对每块网卡(Network Interface Card)进行分别指定，具有唯一性，但不具有层次性。

![Xshot-0811](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0811.PNG)

##### 网络的构成要素

![Xshot-0812](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0812.PNG)

##### 现代网络实态

城市之间用**骨干网**连接，选用高速路由器相互连接快速传输大量数据，类似于高速公路。网络中相应于高速公路出入口的部分称为**边缘网络**，常用的设备有多功能路由器和3层交换机。计算机网络中连接边缘网络的部分叫做**接入层**。骨干网专注于如何提高业务传输性能和网络的生存性，而将具有业务智能化的高速路由器和交换机移到网络的边缘。

**托管主机服务**：托管主机服务指将用于信息发布的主机放置于互联网数据中心的机房，或者从该机房租赁一台计算机作为发布信息主机的服务。

**数据中心**：针对高并发访问，托管主机服务，为了减少网络的延迟，会集合多个存储于一起，通过连接高速网络，以期提高响应速度，这种方式称为数据中心。数据中心有大型服务器,存储以及计算机网络组成，一般直接连接到骨干网或者边缘网络。

**虚拟化和云**：当一个网站需要调整运营所使用的资源时，并不增减服务器,存储设备,网络等实际的物理设备，而是用软件将物理设备虚拟化，在有必要增减资源的时候，通过软件按量增减的一种机制。这种方式可以实现按需分配,按比例分配，对外提供可靠的服务。
利用虚拟化技术，根据使用者的情况动态调整必要资源的机制称为**云**。而且，将虚拟化的系统根据需要自动地进行动态管理的部分被称为**智能协调层**，它能够将服务器,存储,网络看作一个整体进行管理。

## 2.数据链路

**(对应于TCP/IP的网卡层，即网络接口层，包括以太网驱动程序)**

数据链路层的协议定义了通过通信媒介互连的设备之间传输的规范。通信媒介包括双绞线电缆，同轴电缆，光纤，电磁波以及红外线等介质。此外，各个设备之间有时也会通过交换机,网桥,中继器等中转数据。

不同数据链路有个最大区别，就是它们各自的最大传输单位(**MTU**:Maximum Transmission Unit)不同

数据链路的各种主要协议如下：

![Xshot-0814](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0814.PNG)

#### MAC

MAC地址用于识别数据链路中互连的节点。

![Xshot-0815](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0815.PNG)

#### 共享与非共享介质型网络

从通信介质的使用方法上看，网络可分为共享介质型和非共享介质型。

共享介质型网络是指由多个设备共享一个通信介质的一种网络，基本上采用半双工通信(只发送或接收的通信方式)，并有必要对介质进行访问控制。共享性介质网络中有两种介质访问控制方式：一种是争用方式，一种是令牌传递方式。

非共享型介质网络指不共享介质，是对介质采取专用的一种传输控制方式。在这种方式下，网络中的每个站直连交换机，由交换机负责转发数据帧。此方式下，发送端与接收端并不共享通信介质，因此多数情况下采用全双工通信方式(在同一时间既可以发送数据也可以接收数据)。ATM和当今的以太网一般都采用这种方式，该方式还可以根据交换机的高级特性构建虚拟局域网(VLAN,Virtual Loacl Network)，进行流量控制等。但是，这种方式也有一个致命的弱点，那就是一旦交换机发生故障，那与之相连的所有计算机之间都无法进行通信。

![Xshot-0816](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0816.PNG)

#### 以太网

在众多数据链路中最为著名,使用最为广泛的莫过于以太网(Ethernet)，它的规范简单，易于NIC(网卡)及驱动程序实现。

以太网因通信电缆的不同及通信速度的差异，衍生出众多不同的以太网类型。通信介质包括同轴电缆，双绞线等。

以太网帧的格式：

![Xshot-0817](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0817.PNG)

以太网前端有一个叫前导码(Preambel)的部分，它是由0,1数字交替组合而成，表示一个以太网帧的开始，也是对端网卡能够确认与其同步的标志。

类型包含表示协议类型的编号，表明了以太网上一层网络协议的类型，常用的有IP 0800,ARP 0806,RARP 8035以及IPv6 86DD。

帧尾是一个叫做FCS(Frame Check Sequence,帧检验序列，保存着整个帧除以多项式的余数)的4个字节。它可以检查帧是否有所损坏。在通信过程中如果出现电子噪声的干扰，可能会影响发送数据导致乱码位的出现。因此，通过检查这个FCS字段的值可以将哪些受到噪声干扰的错误帧丢弃。

#### 无线通信

无线通信通常使用电磁波,红外线,激光等方式进行传播数据，一般在办公室或家庭的局域网范围内组成的较为高速的连接称为无线局域网。

包括蓝牙(是使用2.4Ghz频率无线电波的一种标准)，Wi-Fi(WireLess Fidelity，指高质量的无线LAN)，WiMax(Worldwide Interoperability for Microware Access，是使用微波在企业或家庭实现无线通信的一种方式)，ZigBee(主要用于家电的远程控制，是一种短距离,低功耗的无线通信技术)等。

#### PPP

PPP(Point-to-Point Protocol)是指点对点，即1对1连接计算机的协议，相当于位于OSI参考模型的第2层数据链路层。

PPP不像以太网和FDDI，后两者不仅与数据链路层有关，还与物理层有关。具体来讲，以太网使用同轴电缆或双绞线，它可以决定其中0,1被解释为何种电子信号。而PPP属于纯粹的数据链路层，与物理层没有任何关系，需要物理层的支持，可以使用电话线或ISDN，专线，ATM线路等。

**PPPoE**是在以太网上的数据中加入PPP帧进行传输的一种方式。单纯的以太网没有验证功能，也没有建立和断开的处理，因此无法按时计费。而如果采用PPPoE管理以太网连接，就可以利用PPP的验证等功能使各家互联网接入服务商可以有效地管理终端用户的使用。

## 3.IP网络层

IP(Internet Protocol,网际协议)，主要负责将数据包发送给目标地址的计算机，实现终端节点之间的通信，即点对点通信。

IP大致分为3个作用模块，分别是IP寻址，路由控制(Routing，将分组数据发送到最终节点)，以及IP分包和组包。

IP面向无不连接。即在发包之前，不需要建立与对端目标地址之间的连接。上一层如果遇到需要发送给IP的数据，该数据会立即被压缩成IP包发送出去。它并不做"最终收到与否的验证"，IP数据包在途中可能会发生丢包，错位以及数据量翻倍等问题。如果说IP只负责将数据发送给主机，那么TCP则负责保证对端主机确实收到了数据。
为什么IP要采用面向无连接呢？一是为了简化，二是为了提速。
需要有连接时，可以委托上一层提供次服务。

IP地址有"网络标识(网络地址)"和"主机标识(主机地址)"两部分组成。
网络标识在数据链路的每个段配置不同的值，网络标识必须保证相互连接的每个段的地址不相重复。而相同段内相连的主机必须有相同的网络地址。主机标识则不允许在同一个网段内重复出现。IP地址具有层次性和唯一性。IP地址分为A,B,C,D四个级别。

#### 子网掩码

IP地址的网络标识和主机表示的位数受限与该地址的类别，可能导致网络标识不够用。通过子网掩码可以将A,B,C类网络地址细分出更小粒度的子网，一个IP地址可以不受限于自己的类别，而是可以通过子网掩码自由地定位自己的网络标识的长度。这种方式，实际上是将原来A,B,C类分类中的主机地址部分作为子网地址，将原网络划分为多个物理网络的一种机制。

#### CIDR和VLSM

CIDR(Classless Inter-Domain Routing，无类型域间选路)，采用任意长度分割IP地址的网络标识和主机标识，根据CIDR，连续多个C类地址就可以划分到一个较大的网络内，更有效地利用了当前的IPv4地址，同时通过路由集中降低了路由器的负担。

VLSM(Variable Length Susnet Mask，可变长子网掩码)，可以随机修改组织内各部门的子网掩码长度。

#### 路由控制

IP地址的网络地址部分用于进行路由控制。路由控制表中记录**着网络地址**与下一步应该发送至路由器的地址(包括网络地址和主机地址)。

#### IPv4首部

![Xshot-0819](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0819.PNG)

#### IPv6首部

![Xshot-0820](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0820.PNG)

#### DNS

DNS(Domain Name System)，将主机名转换为IP地址。

在应用中，当用户输入主机名(域名)时，DNS会自动检索那个注册了主机名个IP地址的数据库，并迅速定位对应的IP地址。而且，如果主机名和IP地址需要变更时，也只需要在组织机构内部进行处理即可，而没必要再向其他的机构进行申请或报告。

域名是为了识别主机名称和组织名称的一种具有分层的名称。

#### ARP

ARP(Address Resolution Protocol)是一种解决地址问题的协议。以目标IP地址为线索，用来定位下一个应该接收数据分包的网络设备对应的MAC地址。如果目标主机不在同一个链路上，可以通过ARP查找下一跳路由器的MAC地址。

工作机制：从一个IP地址发送ARP请求包以了解其MAC地址，目标地址将自己的MAC地址填入ARP响应包返回到IP地址。由此，可以通过ARP从IP地址获得MAC地址，实现链路内的IP通信。

RARP(Reverse Address Resolution Protocol)是将ARP反过来，从MAC地址定位IP地址的一种协议。例如将打印机服务器等小型嵌入式设备接入到网络时就经常会用得到。

#### ICMP

ICMP用于确认网络是否正常工作，以及遇到异常时进行问题诊断。

主要功能包括：确认IP包是否成功到达目标地址，通知在发送过程中IP包被遗弃的具体原因，改善网络设置等。

ICMP的消息大致可以分为两类：一类是通知出错原因的错误消息，另一类是用于诊断的查询消息。

#### DHCP

DHCP(Dynamic Host Configuration Protocol)，用于实现自动设置IP地址,统一管理IP地址分配。有了DHCP，计算机只要连接到网络，就可以进行TCP/IP通信，也就是说，DHCP实现了即插即用。

使用DHCP之前，首先要架设一台DHCP服务器，然后将DHCP所要分配的IP地址设置到服务器上，此外，还需要将相应的子网掩码,路由控制信息以及DNS服务器的地址设置到服务器上。对于家庭小规模的网段，很多时候，DHCP服务器由该网段的路由器充当；对于企业或学校等较大规模组织机构的网络环境当中，一般会有多个以太网(无线LAN)网段，可以在每个网段设置一个DHCP中继代理器。它可以设置DHCP服务器的IP地址，从而可以在DHCP服务器上为每个网段注册IP地址的分配范围。

#### NAT

NAT(Network Address Translator)，用于在本地网络中使用私有地址，在连接互联网时转换为全局IP地址。

除转换IP地址外，还出现了可以转换TCP,UDP端口号的NAPT(Network Address Port Translator)技术，由此可以实现用一个全局IP地址与多个主机的通信。

NAT实际是为了正在面临地址枯竭的IPv4而开发的技术。

**NAT-PT(NAPT-PT):**将IPv6首部转换为IPv4的首部的一种技术。有了这种技术，那些只有IPv6地址的主机只能够与IPv4地址的其他主机进行通信了。

#### IP隧道

在网络层的首部后面继续追加网络层首部的通信方法。用于实现不同类型的网络之间的通信。

## 4.传输层

### TCP：

Transmision Control Protocol

TCP是一种面向有连接的,可靠的流协议。它可以保证两端通信主机之间的通信可达，提供可靠的通信传输。实行“顺序控制”或"重发控制”机制，可以正确处理在传输过程中丢包,传输顺序乱掉等异常情况，还具备“流控制(流量控制)”,"拥塞控制",能够有效利用带宽，缓解网络拥堵,提高网络利用率。

然而，为了建立与断开连接，它需要至少7次的发包收包，导致网络流量的浪费。此外，为了提高网络利用率，TCP协议中定义了各种各样复杂的规范，不利于视频会议(音频,视频的数量既定)的场合使用。

#### TCP相关控制细节

TCP提供检验和，序列号，确认应答，重发控制，连接管理以及窗口控制等机制实现可靠传输。

##### 通过序列号和确认应答提高可靠性

##### 连接管理

![Xshot-0847](D:\My_Program_data\Summary-of-Computer-Network\captures\Xshot-0847.png)

##### TCP以段为单位发送数据

在建立TCP连接的同时，也可以确定发送数据包的单位，我们可以将其称之为最大消息长度(MSS，Maxmum Segment Size)。最理想的情况是，最大消息长度正好是IP中不会被分片处理的最大数据长度。TCP在发送大量数据时，是以MSS的大小将数据进行分割发送。进行重发时也是以MSS为单位。MSS是在三次握手时，在两端主机之间被计算得出。两端主机在发出建立连接的请求时，会在TCP首部写入MSS选项，高告诉对方自己的接口能够适应的MSS大小，然后会在两者之间选一个较小的值投入使用。

##### 利用滑动窗口提高速度

TCP以一个段为单位，每发送一个段需要进行一次确认应答的处理，这样造成包的往返时间越长通信性能越低。为解决这个问题，TCP使用引入了窗口这个概念。确认应答不再是以每个分段，而是以更大的单位进行确认，发送端主机在发送了一个段之后不必一直等待确认应答，而是继续发送，这样可以大幅缩短转发时间。

###### 窗口控制与重发机制

在确认应答未能返回的情况下，数据已经达到了对端，不需要再进行重发。使用了窗口控制，某些确认应答即便丢失了也无需重发。

在某个报文段丢失的情况下，发送端主机如果连续3次收到同一个确认应答，才会对其所对应的数据进行重发，这种机制比之前的超时重发管理机制更加有效，因此也被称作高速重发机制。

### UDP:

User Datagram Protocol/用户数据报协议

UDP是一种面向无连接的传输层协议，不提供复杂的控制机制，利用IP提供面向无连接的通信服务,将控制细节交由应用层去处理，自己只提供作为传输层最基本的功能。而且它是在将应用程序发来的数据在收到的那一刻，立即按照原样发送到网络上的一种机制，即可以随时发送数据。不关注对端是否真的接收到了传过去的数据，不进行重发，也无法进行流量控制等避免网络拥塞的行为。如果需要检查对端是否收到了分组数据包，或者是否连接到了网络，则需要在上层的应用程序中实现。UDP简单而高效，适用于高速传输和实时性要求较高的通信或广播通信：

* 包总量较少的通信(DNS，SNMP等)
* 视频，音频等对即时通信要求较高的多媒体通信
* 限定于LAN等特定网络内的应用通信
* 广播通信(广播，多播）
  RIP,DHCP等基于广播的协议也要依赖于UDP

TCP与UDP的优缺点无法简单地,绝对地去做比较，应当根据应用的目的按需使用。

### 端口号

端口号用来识别同一台计算机中进行通信的不同应用程序，也称为程序地址。传输协议TCP,UDP通过接收数据中的目标端口号识别目标处理程序。

TCP/IP或UDP/IP通信中通常采用5个信息来识别一个通信：源IP地址，目标IP地址，协议号，源端口号，目标端口号。(协议号即是传输层协议，一般是TCP或UDP，不同协议可以使用同一个端口号)

知名端口号(Well-Known Port Number)：

21：ftp	22:ssh	53:domain	80:http(www,www-http)

## 5.应用层

## 6.网络安全

`